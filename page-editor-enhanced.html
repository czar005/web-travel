<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü - WorldTravel</title>
    <link rel="stylesheet" href="admin-style.css">
    <style>
        .image-manager {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        
        .image-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            overflow: hidden;
            background: white;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }
        
        .image-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .unified-editor {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        
        <script>
            // –†–∞—Å—à–∏—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            if (window.editor) {
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
                window.editor.addImageManagers = function() {
                    const sectionsWithImages = [
                        { id: 'hero', name: '–ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä', field: 'image' },
                        { id: 'about', name: '–û –∫–æ–º–ø–∞–Ω–∏–∏', field: 'image' },
                        { id: 'services', name: '–£—Å–ª—É–≥–∏', field: 'image' },
                        { id: 'destinations', name: '–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è', field: 'image' },
                        { id: 'contact', name: '–ö–æ–Ω—Ç–∞–∫—Ç—ã', field: 'image' }
                    ];
                    
                    sectionsWithImages.forEach(section => {
                        this.addImageManagerToSection(section.id, section.name, section.field);
                    });
                };
                
                window.editor.addImageManagerToSection = function(sectionId, sectionName, fieldId) {
                    if (this.currentSection?.id !== sectionId) return;
                    
                    const contentEditor = document.getElementById('content-editor');
                    if (!contentEditor) return;
                    
                    const currentImage = this.getCurrentValue(fieldId) || '';
                    
                    const imageManagerHTML = `
                        <div class="image-manager">
                            <h4>üñºÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–ª—è "${sectionName}"</h4>
                            <div class="image-preview">
                                ${currentImage ? 
                                    `<img src="${currentImage}" alt="Preview" onerror="this.style.display='none'">` :
                                    `<div style="text-align: center; color: #666;">
                                        <i class="fas fa-image" style="font-size: 3em; margin-bottom: 10px;"></i>
                                        <div>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                                    </div>`
                                }
                            </div>
                            <div class="image-actions">
                                <button class="btn-admin" onclick="editor.uploadImage('${fieldId}')">
                                    <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                                </button>
                                <button class="btn-admin secondary" onclick="editor.setImageUrl('${fieldId}')">
                                    <i class="fas fa-link"></i> –£–∫–∞–∑–∞—Ç—å URL
                                </button>
                                ${currentImage ? `
                                <button class="btn-admin danger" onclick="editor.removeImage('${fieldId}')">
                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                                ` : ''}
                            </div>
                            <input type="hidden" data-field="${fieldId}" value="${currentImage}">
                        </div>
                    `;
                    
                    // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                    const titleField = contentEditor.querySelector('[data-field="title"]');
                    if (titleField) {
                        titleField.closest('.form-group').insertAdjacentHTML('afterend', imageManagerHTML);
                    }
                };
                
                // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
                window.editor.uploadImage = function(fieldId) {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = 'image/*';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.updateImageField(fieldId, e.target.result);
                            };
                            reader.readAsDataURL(file);
                        }
                    };
                    input.click();
                };
                
                window.editor.setImageUrl = function(fieldId) {
                    const currentValue = this.getCurrentValue(fieldId);
                    const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', currentValue || '');
                    if (url !== null) {
                        this.updateImageField(fieldId, url);
                    }
                };
                
                window.editor.removeImage = function(fieldId) {
                    if (confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
                        this.updateImageField(fieldId, '');
                    }
                };
                
                window.editor.updateImageField = function(fieldId, url) {
                    const field = document.querySelector(`[data-field="${fieldId}"]`);
                    if (field) {
                        field.value = url;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                        const preview = document.querySelector(`[data-field="${fieldId}"]`).closest('.image-manager').querySelector('.image-preview');
                        if (preview) {
                            if (url) {
                                preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.style.display='none'">`;
                            } else {
                                preview.innerHTML = `
                                    <div style="text-align: center; color: #666;">
                                        <i class="fas fa-image" style="font-size: 3em; margin-bottom: 10px;"></i>
                                        <div>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                                    </div>
                                `;
                            }
                        }
                        
                        this.hasUnsavedChanges = true;
                    }
                };
                
                // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                window.editor.addUnifiedStatsEditor = function() {
                    if (this.currentSection?.id !== 'about') return;
                    
                    const contentEditor = document.getElementById('content-editor');
                    if (!contentEditor) return;
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã
                    const oldEditors = contentEditor.querySelectorAll('[class*="stats"]');
                    oldEditors.forEach(editor => {
                        if (!editor.closest('.action-buttons')) {
                            editor.remove();
                        }
                    });
                    
                    const stats = this.currentData.content?.about?.stats || [];
                    
                    const statsHTML = `
                        <div class="unified-editor">
                            <h4>üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</h4>
                            <div id="stats-list">
                                ${stats.map((stat, index) => `
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                        <input type="text" class="form-control" value="${stat.value}" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ" 
                                               onchange="editor.updateStat(${index}, 'value', this.value)">
                                        <input type="text" class="form-control" value="${stat.label}" placeholder="–ü–æ–¥–ø–∏—Å—å" 
                                               onchange="editor.updateStat(${index}, 'label', this.value)">
                                        <button class="btn-small danger" onclick="editor.removeStat(${index})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="btn-admin" onclick="editor.addStat()">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </button>
                        </div>
                    `;
                    
                    const descriptionField = contentEditor.querySelector('[data-field="description"]');
                    if (descriptionField) {
                        descriptionField.closest('.form-group').insertAdjacentHTML('afterend', statsHTML);
                    }
                };
                
                // –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è —É—Å–ª—É–≥
                window.editor.addUnifiedServicesEditor = function() {
                    if (this.currentSection?.id !== 'services') return;
                    
                    const contentEditor = document.getElementById('content-editor');
                    if (!contentEditor) return;
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã
                    const oldEditors = contentEditor.querySelectorAll('[class*="services"]');
                    oldEditors.forEach(editor => {
                        if (!editor.closest('.action-buttons')) {
                            editor.remove();
                        }
                    });
                    
                    const services = this.currentData.content?.services?.services || [];
                    
                    const servicesHTML = `
                        <div class="unified-editor">
                            <h4>üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</h4>
                            <div id="services-list">
                                ${services.map((service, index) => `
                                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px;">
                                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                            <input type="text" class="form-control" value="${service.title}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏" 
                                                   onchange="editor.updateService(${index}, 'title', this.value)">
                                            <input type="text" class="form-control" value="${service.icon}" placeholder="–ò–∫–æ–Ω–∫–∞" 
                                                   onchange="editor.updateService(${index}, 'icon', this.value)">
                                        </div>
                                        <textarea class="form-control" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏" 
                                                  onchange="editor.updateService(${index}, 'description', this.value)">${service.description}</textarea>
                                        <button class="btn-small danger" onclick="editor.removeService(${index})" style="margin-top: 10px;">
                                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="btn-admin" onclick="editor.addService()">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
                            </button>
                        </div>
                    `;
                    
                    const titleField = contentEditor.querySelector('[data-field="title"]');
                    if (titleField) {
                        titleField.closest('.form-group').insertAdjacentHTML('afterend', servicesHTML);
                    }
                };
                
                // –ü–∞—Ç—á–∏–º –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                const originalShowContentEditor = window.editor.showContentEditor;
                window.editor.showContentEditor = function() {
                    originalShowContentEditor.call(this);
                    
                    setTimeout(() => {
                        this.addImageManagers();
                        this.addUnifiedStatsEditor();
                        this.addUnifiedServicesEditor();
                    }, 100);
                };
            }
        </script>
    </div>
</body>
</html>
