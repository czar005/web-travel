<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü - WorldTravel</title>
    <link rel="stylesheet" href="admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .editor-container {
            display: flex;
            height: 100vh;
        }

        .preview-panel {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .editor-panel {
            width: 500px;
            background: white;
            border-left: 2px solid #e1e5e9;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 20px;
            background: #2c5aa0;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .preview-frame-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        .section-item {
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .section-item:hover {
            border-color: #2c5aa0;
            background: #e3f2fd;
        }

        .section-item.active {
            border-color: #2c5aa0;
            background: #2c5aa0;
            color: white;
        }

        .save-indicator {
            background: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 20px;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .save-indicator.show {
            display: flex;
        }

        /* Enhanced Editor Styles */
        .enhanced-editor-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }
        
        .enhanced-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }
        
        .enhanced-editor-title {
            color: #2c5aa0;
            font-size: 1.2em;
            font-weight: 600;
        }
        
        .stats-grid-editor {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-editor-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .image-manager-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed #dee2e6;
        }
        
        .image-preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .image-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        
        .image-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .block-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2c5aa0;
        }
        
        .add-block-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-block-btn:hover {
            background: #218838;
        }
        
        .remove-block-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-block-btn:hover {
            background: #c82333;
        }
        
        .enhanced-form-group {
            margin-bottom: 15px;
        }
        
        .enhanced-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        .enhanced-form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .enhanced-form-control:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="preview-panel">
            <div class="panel-header">
                <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
                <div>
                    <button class="btn-admin warning" onclick="editor.safeRefresh()">
                        <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="btn-admin success" onclick="editor.saveAndExit()" style="margin-left: 10px;">
                        <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏
                    </button>
                </div>
            </div>
            
            <div class="save-indicator" id="save-indicator">
                <i class="fas fa-check-circle"></i>
                <span id="save-message">–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã</span>
            </div>

            <div class="preview-frame-container">
                <iframe class="preview-frame" id="preview-frame" src="index.html?editor=true&nocache=1"></iframe>
            </div>
        </div>

        <div class="editor-panel">
            <div class="panel-header">
                <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
            </div>

            <div class="panel-content">
                <h3>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
                <p style="color: #666; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–∫—Ü–∏—é –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                
                <div id="section-list">
                    <div class="section-item" data-section="hero">
                        <div class="section-title">–ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</div>
                        <div class="section-desc">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π</div>
                    </div>
                    <div class="section-item" data-section="about">
                        <div class="section-title">–û –∫–æ–º–ø–∞–Ω–∏–∏</div>
                        <div class="section-desc">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    </div>
                    <div class="section-item" data-section="services">
                        <div class="section-title">–£—Å–ª—É–≥–∏</div>
                        <div class="section-desc">–°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –∫–æ–º–ø–∞–Ω–∏–∏</div>
                    </div>
                    <div class="section-item" data-section="destinations">
                        <div class="section-title">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                        <div class="section-desc">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
                    </div>
                    <div class="section-item" data-section="contact">
                        <div class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                        <div class="section-desc">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                    </div>
                </div>

                <div id="content-editor" style="margin-top: 30px; display: none;">
                    <!-- Basic editor fields -->
                    <div class="basic-editor">
                        <div class="form-group">
                            <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏:</label>
                            <input type="text" class="form-control" id="section-title">
                        </div>
                        <div class="form-group">
                            <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                            <textarea class="form-control" id="section-description" rows="4"></textarea>
                        </div>
                        <button class="btn-admin" onclick="editor.saveSection()">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                    
                    <!-- Enhanced editor will be injected here -->
                    <div id="enhanced-editor-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Page Editor with fixed stats and services - FIXED VERSION
        class SimplePageEditor {
            constructor() {
                this.currentSection = null;
                this.currentData = null;
                this.init();
            }

            init() {
                console.log('üöÄ Page Editor initialized');
                this.setupSectionHandlers();
                this.loadData();
            }

            setupSectionHandlers() {
                const sectionItems = document.querySelectorAll('.section-item');
                sectionItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const sectionId = item.getAttribute('data-section');
                        this.selectSection(sectionId);
                    });
                });
            }

            loadData() {
                if (window.dataManager) {
                    this.currentData = window.dataManager.getData();
                    console.log('üìÅ Initial data loaded:', this.currentData);
                    
                    if (!this.currentData) {
                        this.currentData = this.getDefaultData();
                        console.log('üìÅ Using default data');
                    }
                    
                    if (!this.currentData.content) {
                        this.currentData.content = {};
                        console.log('üìÅ Created content structure');
                    }
                } else {
                    this.currentData = this.getDefaultData();
                    console.log('üìÅ DataManager not available, using default data');
                }
            }

            getDefaultData() {
                return {
                    content: {
                        hero: {
                            title: "–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏—Ä —Å WorldTravel",
                            description: "–ú—ã —Å–æ–∑–¥–∞–µ–º –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É. –û—Ç —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª—è–∂–µ–π –¥–æ –≥–æ—Ä–Ω—ã—Ö –≤–µ—Ä—à–∏–Ω - –≤–∞—à–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.",
                            buttonText: "–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ",
                            backgroundImage: ""
                        },
                        about: {
                            title: "–û –Ω–∞—Å",
                            description: "WorldTravel - —ç—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ø–æ —Ç—É—Ä–∏–∑–º—É —Å –±–æ–ª–µ–µ —á–µ–º 10-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã. –ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö travel-—Ä–µ—à–µ–Ω–∏–π.",
                            image: "",
                            stats: [
                                { value: "5000+", label: "–î–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤" },
                                { value: "50+", label: "–°—Ç—Ä–∞–Ω –º–∏—Ä–∞" },
                                { value: "10 –ª–µ—Ç", label: "–û–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã" }
                            ]
                        },
                        services: {
                            title: "–£—Å–ª—É–≥–∏",
                            description: "–ù–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è",
                            services: [
                                {
                                    title: "–ê–≤–∏–∞–±–∏–ª–µ—Ç—ã",
                                    description: "–ü–æ–¥–±–æ—Ä –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª—É—á—à–∏—Ö –∞–≤–∏–∞–ø–µ—Ä–µ–ª–µ—Ç–æ–≤ –ø–æ –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º",
                                    icon: "fas fa-plane"
                                },
                                {
                                    title: "–û—Ç–µ–ª–∏", 
                                    description: "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–µ–ª–µ–π –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è –∫–æ–º—Ñ–æ—Ä—Ç–∞ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É",
                                    icon: "fas fa-hotel"
                                }
                            ]
                        },
                        destinations: {
                            title: "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è", 
                            subtitle: "–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –ª—É—á—à–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏—Ä–∞ —Å –Ω–∞—à–∏–º–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º–∏ —Ç—É—Ä–∞–º–∏"
                        },
                        contact: {
                            title: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
                            description: "–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞—à–µ–≥–æ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è"
                        }
                    },
                    lastUpdate: new Date().toISOString()
                };
            }

            selectSection(sectionId) {
                console.log('üéØ Selecting section:', sectionId);
                
                document.querySelectorAll('.section-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

                this.currentSection = sectionId;
                this.loadSectionData(sectionId);
                
                document.getElementById('content-editor').style.display = 'block';
                this.injectEnhancedEditor();
            }

            loadSectionData(sectionId) {
                console.log('üìù Loading section data for:', sectionId);
                
                if (!this.currentData.content[sectionId]) {
                    const defaultData = this.getDefaultData();
                    this.currentData.content[sectionId] = defaultData.content[sectionId] || {};
                    console.log('üìÅ Created section data:', this.currentData.content[sectionId]);
                }

                const sectionData = this.currentData.content[sectionId];
                if (sectionData) {
                    document.getElementById('section-title').value = sectionData.title || '';
                    document.getElementById('section-description').value = sectionData.description || '';
                    console.log('‚úÖ Loaded basic data:', { 
                        title: sectionData.title, 
                        description: sectionData.description 
                    });
                }
            }

            injectEnhancedEditor() {
                const contentEditor = document.getElementById('enhanced-editor-content');
                if (!contentEditor) {
                    console.error('‚ùå Enhanced editor container not found');
                    return;
                }

                contentEditor.innerHTML = '';
                console.log('üîÑ Injecting enhanced editor for section:', this.currentSection);

                switch (this.currentSection) {
                    case 'hero':
                        this.injectHeroEditor(contentEditor);
                        break;
                    case 'about':
                        this.injectAboutEditor(contentEditor);
                        break;
                    case 'services':
                        this.injectServicesEditor(contentEditor);
                        break;
                    case 'destinations':
                        this.injectDestinationsEditor(contentEditor);
                        break;
                    case 'contact':
                        this.injectContactEditor(contentEditor);
                        break;
                    default:
                        console.warn('‚ö†Ô∏è Unknown section:', this.currentSection);
                }
            }

            // Hero Section Editor
            injectHeroEditor(container) {
                const data = this.currentData.content.hero || {};
                console.log('üéØ Injecting hero editor with data:', data);
                
                const html = `
                    <div class="enhanced-editor-section">
                        <div class="enhanced-editor-header">
                            <div class="enhanced-editor-title">üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        </div>
                        
                        <div class="image-manager-section">
                            <div class="enhanced-form-group">
                                <label>–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                                <div class="image-preview-container">
                                    ${data.backgroundImage ? 
                                        `<img src="${data.backgroundImage}" alt="Preview" class="image-preview" onerror="this.style.display='none'">` :
                                        `<div style="text-align: center; color: #6c757d; padding: 20px;">
                                            <i class="fas fa-image" style="font-size: 3em; margin-bottom: 10px;"></i>
                                            <div>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
                                        </div>`
                                    }
                                    <div class="image-actions">
                                        <button type="button" class="btn-admin" onclick="editor.uploadImage('backgroundImage')">
                                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                                        </button>
                                        <button type="button" class="btn-admin secondary" onclick="editor.setImageUrl('backgroundImage')">
                                            <i class="fas fa-link"></i> URL
                                        </button>
                                        ${data.backgroundImage ? `
                                        <button type="button" class="btn-admin danger" onclick="editor.removeImage('backgroundImage')">
                                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="enhanced-form-group">
                            <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏:</label>
                            <input type="text" class="enhanced-form-control" id="hero-button-text" 
                                   value="${data.buttonText || '–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ'}" 
                                   oninput="editor.updateHeroField('buttonText', this.value)">
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            }

            // About Section Editor with Stats - FIXED
            injectAboutEditor(container) {
                const data = this.currentData.content.about || {};
                const stats = data.stats || [];
                console.log('üè¢ Injecting about editor with stats:', stats);

                const html = `
                    <div class="enhanced-editor-section">
                        <div class="enhanced-editor-header">
                            <div class="enhanced-editor-title">üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</div>
                            <button type="button" class="add-block-btn" onclick="editor.addStatBlock()">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                            </button>
                        </div>

                        <div class="image-manager-section">
                            <div class="enhanced-form-group">
                                <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                                <div class="image-preview-container">
                                    ${data.image ? 
                                        `<img src="${data.image}" alt="Preview" class="image-preview" onerror="this.style.display='none'">` :
                                        `<div style="text-align: center; color: #6c757d; padding: 20px;">
                                            <i class="fas fa-building" style="font-size: 3em; margin-bottom: 10px;"></i>
                                            <div>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
                                        </div>`
                                    }
                                    <div class="image-actions">
                                        <button type="button" class="btn-admin" onclick="editor.uploadImage('image')">
                                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                                        </button>
                                        <button type="button" class="btn-admin secondary" onclick="editor.setImageUrl('image')">
                                            <i class="fas fa-link"></i> URL
                                        </button>
                                        ${data.image ? `
                                        <button type="button" class="btn-admin danger" onclick="editor.removeImage('image')">
                                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="stats-grid-editor" id="stats-editor-container">
                            ${stats.map((stat, index) => `
                                <div class="stat-editor-item">
                                    <div class="enhanced-form-group">
                                        <label>–ó–Ω–∞—á–µ–Ω–∏–µ:</label>
                                        <input type="text" class="enhanced-form-control stat-value" 
                                               value="${stat.value}" 
                                               oninput="editor.updateStatBlock(${index}, 'value', this.value)"
                                               placeholder="5000+">
                                    </div>
                                    <div class="enhanced-form-group">
                                        <label>–ü–æ–¥–ø–∏—Å—å:</label>
                                        <input type="text" class="enhanced-form-control stat-label" 
                                               value="${stat.label}" 
                                               oninput="editor.updateStatBlock(${index}, 'label', this.value)"
                                               placeholder="–î–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤">
                                    </div>
                                    <div style="text-align: right;">
                                        <button type="button" class="remove-block-btn" onclick="editor.removeStatBlock(${index})">
                                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                            ${stats.length === 0 ? `
                                <div style="text-align: center; padding: 40px 20px; color: #666; grid-column: 1 / -1;">
                                    <i class="fas fa-chart-bar" style="font-size: 3em; margin-bottom: 15px; display: block; color: #ccc;"></i>
                                    <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞</p>
                                    <small>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</small>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                container.innerHTML = html;
                console.log('‚úÖ About editor injected with', stats.length, 'stats blocks');
            }

            // Services Section Editor - FIXED
            injectServicesEditor(container) {
                const data = this.currentData.content.services || {};
                const services = data.services || [];
                console.log('‚ö° Injecting services editor with services:', services);

                const html = `
                    <div class="enhanced-editor-section">
                        <div class="enhanced-editor-header">
                            <div class="enhanced-editor-title">‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</div>
                            <button type="button" class="add-block-btn" onclick="editor.addServiceBlock()">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
                            </button>
                        </div>

                        <div id="services-editor-container">
                            ${services.map((service, index) => `
                                <div class="block-item">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: start; margin-bottom: 10px;">
                                        <div class="enhanced-form-group">
                                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:</label>
                                            <input type="text" class="enhanced-form-control service-title" 
                                                   value="${service.title}" 
                                                   oninput="editor.updateServiceBlock(${index}, 'title', this.value)"
                                                   placeholder="–ê–≤–∏–∞–±–∏–ª–µ—Ç—ã">
                                        </div>
                                        <div class="enhanced-form-group">
                                            <label>–ò–∫–æ–Ω–∫–∞:</label>
                                            <input type="text" class="enhanced-form-control service-icon" 
                                                   value="${service.icon}" 
                                                   oninput="editor.updateServiceBlock(${index}, 'icon', this.value)"
                                                   placeholder="fas fa-plane">
                                        </div>
                                        <div>
                                            <button type="button" class="remove-block-btn" onclick="editor.removeServiceBlock(${index})">
                                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </div>
                                    </div>
                                    <div class="enhanced-form-group">
                                        <label>–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:</label>
                                        <textarea class="enhanced-form-control service-description" rows="2"
                                                  oninput="editor.updateServiceBlock(${index}, 'description', this.value)"
                                                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏...">${service.description}</textarea>
                                    </div>
                                    ${service.icon ? `
                                    <div style="background: #e9ecef; padding: 8px 12px; border-radius: 4px; margin-top: 8px; font-size: 0.9em;">
                                        <i class="${service.icon}" style="margin-right: 6px;"></i>
                                        <span>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∫–æ–Ω–∫–∏</span>
                                    </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                            ${services.length === 0 ? `
                                <div style="text-align: center; padding: 40px 20px; color: #666;">
                                    <i class="fas fa-concierge-bell" style="font-size: 3em; margin-bottom: 15px; display: block; color: #ccc;"></i>
                                    <p>–£—Å–ª—É–≥–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                                    <small>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —É—Å–ª—É–≥—É</small>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                container.innerHTML = html;
                console.log('‚úÖ Services editor injected with', services.length, 'services');
            }

            // Other section editors
            injectDestinationsEditor(container) {
                container.innerHTML = `
                    <div class="enhanced-editor-section">
                        <div class="enhanced-editor-header">
                            <div class="enhanced-editor-title">üåç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        </div>
                        <p style="color: #666; margin: 0;">–î–ª—è —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                    </div>
                `;
            }

            injectContactEditor(container) {
                container.innerHTML = `
                    <div class="enhanced-editor-section">
                        <div class="enhanced-editor-header">
                            <div class="enhanced-editor-title">üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        </div>
                        <p style="color: #666; margin: 0;">–î–ª—è —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                    </div>
                `;
            }

            // Data Management Methods
            updateHeroField(field, value) {
                console.log('üéØ Updating hero field:', field, value);
                if (!this.currentData.content.hero) {
                    this.currentData.content.hero = {};
                }
                this.currentData.content.hero[field] = value;
            }

            // Stats Management - FIXED
            addStatBlock() {
                console.log('‚ûï Adding stat block');
                
                if (!this.currentData.content.about) {
                    this.currentData.content.about = {};
                    console.log('üìÅ Created about section');
                }
                if (!this.currentData.content.about.stats) {
                    this.currentData.content.about.stats = [];
                    console.log('üìÅ Created stats array');
                }

                const newStat = {
                    value: '1000+',
                    label: '–ù–æ–≤—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å'
                };
                
                this.currentData.content.about.stats.push(newStat);
                console.log('‚úÖ Added stat block:', newStat);
                console.log('üìä Current stats:', this.currentData.content.about.stats);

                this.showNotification('–ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                this.injectAboutEditor(document.getElementById('enhanced-editor-content'));
            }

            updateStatBlock(index, field, value) {
                console.log('üìä Updating stat block:', index, field, value);
                
                if (this.currentData.content.about?.stats?.[index]) {
                    this.currentData.content.about.stats[index][field] = value;
                    console.log('‚úÖ Stat block updated:', this.currentData.content.about.stats[index]);
                } else {
                    console.error('‚ùå Stat block not found at index:', index);
                }
            }

            removeStatBlock(index) {
                console.log('üóëÔ∏è Removing stat block:', index);
                
                if (this.currentData.content.about?.stats?.[index]) {
                    const removed = this.currentData.content.about.stats.splice(index, 1);
                    console.log('‚úÖ Stat block removed:', removed);
                    console.log('üìä Remaining stats:', this.currentData.content.about.stats);
                    
                    this.showNotification('–ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–¥–∞–ª–µ–Ω', 'success');
                    this.injectAboutEditor(document.getElementById('enhanced-editor-content'));
                } else {
                    console.error('‚ùå Stat block not found at index:', index);
                }
            }

            // Services Management - FIXED
            addServiceBlock() {
                console.log('‚ûï Adding service block');
                
                if (!this.currentData.content.services) {
                    this.currentData.content.services = {};
                    console.log('üìÅ Created services section');
                }
                if (!this.currentData.content.services.services) {
                    this.currentData.content.services.services = [];
                    console.log('üìÅ Created services array');
                }

                const newService = {
                    title: '–ù–æ–≤–∞—è —É—Å–ª—É–≥–∞',
                    description: '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–π —É—Å–ª—É–≥–∏',
                    icon: 'fas fa-star'
                };
                
                this.currentData.content.services.services.push(newService);
                console.log('‚úÖ Added service block:', newService);
                console.log('‚ö° Current services:', this.currentData.content.services.services);

                this.showNotification('–£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                this.injectServicesEditor(document.getElementById('enhanced-editor-content'));
            }

            updateServiceBlock(index, field, value) {
                console.log('‚ö° Updating service block:', index, field, value);
                
                if (this.currentData.content.services?.services?.[index]) {
                    this.currentData.content.services.services[index][field] = value;
                    console.log('‚úÖ Service block updated:', this.currentData.content.services.services[index]);
                } else {
                    console.error('‚ùå Service block not found at index:', index);
                }
            }

            removeServiceBlock(index) {
                console.log('üóëÔ∏è Removing service block:', index);
                
                if (this.currentData.content.services?.services?.[index]) {
                    const removed = this.currentData.content.services.services.splice(index, 1);
                    console.log('‚úÖ Service block removed:', removed);
                    console.log('‚ö° Remaining services:', this.currentData.content.services.services);
                    
                    this.showNotification('–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                    this.injectServicesEditor(document.getElementById('enhanced-editor-content'));
                } else {
                    console.error('‚ùå Service block not found at index:', index);
                }
            }

            // Image Management
            uploadImage(field) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.setImage(field, e.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                };
                input.click();
            }

            setImageUrl(field) {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
                if (url) {
                    this.setImage(field, url);
                }
            }

            removeImage(field) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
                    this.setImage(field, '');
                }
            }

            setImage(field, url) {
                console.log('üñºÔ∏è Setting image for', field, url);
                
                if (!this.currentData.content[this.currentSection]) {
                    this.currentData.content[this.currentSection] = {};
                }
                this.currentData.content[this.currentSection][field] = url;
                
                this.showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                this.injectEnhancedEditor();
            }

            // Save Methods - FIXED: Removed calls to non-existent methods
            saveSection() {
                console.log('üíæ Saving section:', this.currentSection);
                
                if (!this.currentSection || !window.dataManager) {
                    console.error('‚ùå Cannot save: no section selected or DataManager not available');
                    return;
                }

                // Update basic fields
                const title = document.getElementById('section-title').value;
                const description = document.getElementById('section-description').value;

                if (!this.currentData.content[this.currentSection]) {
                    this.currentData.content[this.currentSection] = {};
                }

                this.currentData.content[this.currentSection].title = title;
                this.currentData.content[this.currentSection].description = description;

                console.log('üìù Basic fields updated:', { title, description });

                // Get main data and merge
                const mainData = window.dataManager.getData() || this.getDefaultData();
                if (!mainData.content) {
                    mainData.content = {};
                    console.log('üìÅ Created content in main data');
                }
                
                // Ensure the section exists in main data
                if (!mainData.content[this.currentSection]) {
                    mainData.content[this.currentSection] = {};
                }
                
                // Merge ALL changes including stats and services
                Object.assign(mainData.content[this.currentSection], this.currentData.content[this.currentSection]);
                
                console.log('üîÑ Merged section data:', this.currentSection, mainData.content[this.currentSection]);

                mainData.lastUpdate = new Date().toISOString();

                // Simply save the entire data structure
                if (window.dataManager.setData(mainData)) {
                    console.log('‚úÖ Data saved successfully');
                    this.showSaveIndicator('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');
                    this.safeRefresh();
                } else {
                    console.error('‚ùå Failed to save data');
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
            }

            safeRefresh() {
                const frame = document.getElementById('preview-frame');
                frame.src = frame.src.split('?')[0] + '?editor=true&nocache=' + Date.now();
                console.log('üîÑ Preview refreshed');
            }

            saveAndExit() {
                window.location.href = 'admin.html';
            }

            showSaveIndicator(message) {
                const indicator = document.getElementById('save-indicator');
                const messageEl = document.getElementById('save-message');
                
                messageEl.textContent = message;
                indicator.classList.add('show');
                
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 3000);
            }

            showNotification(message, type = 'success') {
                console.log(`üí¨ ${type}: ${message}`);
                alert(`${type === 'success' ? '‚úÖ' : '‚ùå'} ${message}`);
            }
        }

        // Initialize editor when dataManager is ready
        const initEditor = () => {
            if (window.dataManager) {
                console.log('üé¨ Initializing page editor...');
                window.editor = new SimplePageEditor();
                console.log('‚úÖ Page editor initialized successfully');
            } else {
                console.log('‚è≥ Waiting for DataManager...');
                setTimeout(initEditor, 100);
            }
        };

        document.addEventListener('DOMContentLoaded', initEditor);
    </script>
    <script src="data-manager.js"></script>
    <script src="fixed-page-editor.js"></script>
    <script src="editor-patch.js"></script>
</body>
</html>
