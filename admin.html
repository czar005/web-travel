<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldTravel - –ê–¥–º–∏–Ω–∫–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #f5f7fb; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn { 
            background: #2c5aa0; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            width: 90%;
            max-width: 500px;
        }
        .form-group { margin: 15px 0; }
        .form-control { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 16px;
        }
        .country-card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2c5aa0;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script>
        if (!localStorage.getItem('adminAuthenticated')) {
            alert('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!');
            window.location.href = 'admin-login.html';
        }
    </script>

    <div class="container">
        <div class="header">
            <div>
                <h1>üåç WorldTravel Admin</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</p>
            </div>
            <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
        </div>
        
        <div style="margin: 20px 0;">
            <button class="btn btn-success" onclick="openModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</button>
            <button class="btn" onclick="window.open('index.html', '_blank')">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
        
        <div id="countries-list">
            <!-- –°—Ç—Ä–∞–Ω—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal" id="countryModal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
            </div>
            
            <form onsubmit="saveCountry(event)">
                <div class="form-group">
                    <label><strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã:</strong></label>
                    <input type="text" id="countryName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§—Ä–∞–Ω—Ü–∏—è" required>
                </div>
                
                <div class="form-group">
                    <label><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></label>
                    <textarea id="countryDescription" class="form-control" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label><strong>–¶–µ–Ω–∞ –æ—Ç:</strong></label>
                    <input type="text" id="countryPrice" class="form-control" placeholder="–æ—Ç $500" required>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn" onclick="closeModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script src="data-manager.js"></script>
    <script>
    console.log('üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω–∫–∏...');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentEditingId = null;

    // –§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function openModal(countryId = null) {
        console.log('üìù –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Å—Ç—Ä–∞–Ω—ã:', countryId);
        currentEditingId = countryId;
        const modal = document.getElementById('countryModal');
        
        if (!modal) {
            console.error('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!');
            alert('–û—à–∏–±–∫–∞: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }

        if (countryId) {
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω—É';
            fillCountryForm(countryId);
        } else {
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É';
            resetCountryForm();
        }
        
        modal.classList.add('active');
        console.log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ');
    }

    function closeModal() {
        const modal = document.getElementById('countryModal');
        if (modal) {
            modal.classList.remove('active');
        }
        currentEditingId = null;
        console.log('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
    }

    function fillCountryForm(countryId) {
        const countries = window.dataManager.getCountries();
        const country = countries.find(c => c.id === countryId);
        if (country) {
            document.getElementById('countryName').value = country.name || '';
            document.getElementById('countryDescription').value = country.description || '';
            document.getElementById('countryPrice').value = country.price || '';
        }
    }

    function resetCountryForm() {
        document.getElementById('countryName').value = '';
        document.getElementById('countryDescription').value = '';
        document.getElementById('countryPrice').value = '';
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã
    function saveCountry(event) {
        if (event) event.preventDefault();
        
        console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...');
        
        const name = document.getElementById('countryName').value;
        const description = document.getElementById('countryDescription').value;
        const price = document.getElementById('countryPrice').value;

        if (!name || !description || !price) {
            alert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
            return;
        }

        const countryData = {
            id: currentEditingId || 'country-' + Date.now(),
            name: name,
            description: description,
            price: price,
            image: "images/travel-placeholder.jpg"
        };

        console.log('üì¶ –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã:', countryData);

        try {
            const countries = window.dataManager.getCountries();
            
            if (currentEditingId) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                const index = countries.findIndex(c => c.id === currentEditingId);
                if (index !== -1) {
                    countries[index] = countryData;
                    console.log('‚úèÔ∏è –°—Ç—Ä–∞–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                }
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
                countries.push(countryData);
                console.log('‚ûï –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            }

            const success = window.dataManager.updateCountries(countries);
            
            if (success) {
                showNotification(`‚úÖ –°—Ç—Ä–∞–Ω–∞ "${name}" ${currentEditingId ? '–æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–¥–æ–±–∞–≤–ª–µ–Ω–∞'}!`);
                closeModal();
                loadCountries();
            } else {
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã', 'error');
            }
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω—ã:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω—ã', 'error');
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω
    function loadCountries() {
        const container = document.getElementById('countries-list');
        if (!container) {
            console.error('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        const countries = window.dataManager.getCountries();
        console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—Ä–∞–Ω:', countries.length);

        if (countries.length === 0) {
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666; background: white; border-radius: 10px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üåç</div>
                    <h3>–°—Ç—Ä–∞–Ω –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω—É, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</p>
                </div>
            `;
            return;
        }

        container.innerHTML = countries.map(country => `
            <div class="country-card">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <h3 style="margin: 0; color: #2c5aa0;">${country.name}</h3>
                    <strong style="color: #28a745; font-size: 18px;">${country.price}</strong>
                </div>
                <p style="color: #666; line-height: 1.5; margin-bottom: 15px;">${country.description}</p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="openModal('${country.id}')">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn btn-danger" onclick="deleteCountry('${country.id}')">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            </div>
        `).join('');
    }

    function deleteCountry(countryId) {
        if (!confirm('‚ùå –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω—É?')) return;
        
        try {
            const countries = window.dataManager.getCountries().filter(c => c.id !== countryId);
            const success = window.dataManager.updateCountries(countries);
            
            if (success) {
                loadCountries();
                showNotification('‚úÖ –°—Ç—Ä–∞–Ω–∞ —É–¥–∞–ª–µ–Ω–∞!');
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω—ã', 'error');
        }
    }

    function showNotification(message, type = 'success') {
        // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ alert
        alert(message);
    }

    function logout() {
        if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏?')) {
            localStorage.removeItem('adminAuthenticated');
            localStorage.removeItem('adminUsername');
            window.location.href = 'admin-login.html';
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º dataManager
        if (typeof window.dataManager === 'undefined') {
            console.error('‚ùå dataManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
            alert('–û—à–∏–±–∫–∞: dataManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            return;
        }
        
        console.log('‚úÖ dataManager –¥–æ—Å—Ç—É–ø–µ–Ω');
        console.log('üìä –§—É–Ω–∫—Ü–∏–∏ dataManager:', Object.keys(window.dataManager));
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω—ã
        loadCountries();
        
        console.log('‚úÖ –ê–¥–º–∏–Ω–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
    });
    </script>
</body>
</html>
