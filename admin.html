<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldTravel - –ê–¥–º–∏–Ω–∫–∞</title>
    <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial;background:#f5f7fb;padding:20px}.container{max-width:1200px;margin:0 auto}.header{background:white;padding:20px;border-radius:10px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.btn{background:#2c5aa0;color:white;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;margin:5px}.btn-success{background:#28a745}.btn-danger{background:#dc3545}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000}.modal.active{display:flex}.modal-content{background:white;padding:20px;border-radius:10px;width:500px}.form-group{margin:10px 0}.form-control{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px}.tabs{display:flex;gap:10px;margin:20px 0}.tab-btn{padding:10px 20px;border:1px solid #ddd;background:white;cursor:pointer}.tab-btn.active{background:#2c5aa0;color:white}.tab-content{display:none}.tab-content.active{display:block}.country-card{background:white;padding:15px;margin:10px 0;border-radius:5px;border-left:4px solid #2c5aa0}</style>
</head>
<body>
    <script>
        if (!localStorage.getItem('adminAuthenticated')) {
            alert('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!');
            window.location.href = 'admin-login.html';
        }
    </script>

    <div class="container">
        <div class="header">
            <h1>üåç WorldTravel Admin</h1>
            <button class="btn btn-danger" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('countries')">üó∫Ô∏è –°—Ç—Ä–∞–Ω—ã</button>
            <button class="tab-btn" onclick="showTab('content')">üìù –ö–æ–Ω—Ç–µ–Ω—Ç</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –°—Ç—Ä–∞–Ω—ã -->
        <div id="countries" class="tab-content active">
            <button class="btn btn-success" onclick="openModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</button>
            <div id="countries-list" style="margin-top:20px"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–æ–Ω—Ç–µ–Ω—Ç -->
        <div id="content" class="tab-content">
            <form onsubmit="saveContent(event)">
                <div class="form-group">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                    <input type="text" id="hero-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>–¢–µ–∫—Å—Ç:</label>
                    <textarea id="hero-text" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="text" id="contact-phone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="contact-email" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</h3>
            <form onsubmit="saveCountry(event)">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="country-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="country-description" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label>–¶–µ–Ω–∞:</label>
                    <input type="text" id="country-price" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn" onclick="closeModal()">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>

    <script src="data-manager.js"></script>
    <script>
    console.log('üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω–∫–∏...');
    let currentEditingId = null;

    // –¢–∞–±—ã
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById(tabName).classList.add('active');
        document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
    }

    // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    function openModal(countryId = null) {
        currentEditingId = countryId;
        const modal = document.getElementById('modal');
        
        if (countryId) {
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω—É';
            const countries = window.dataManager.getCountries();
            const country = countries.find(c => c.id === countryId);
            if (country) {
                document.getElementById('country-name').value = country.name;
                document.getElementById('country-description').value = country.description;
                document.getElementById('country-price').value = country.price;
            }
        } else {
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É';
            document.getElementById('country-name').value = '';
            document.getElementById('country-description').value = '';
            document.getElementById('country-price').value = '';
        }
        
        modal.classList.add('active');
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
        currentEditingId = null;
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã
    function saveCountry(event) {
        event.preventDefault();
        
        const name = document.getElementById('country-name').value;
        const description = document.getElementById('country-description').value;
        const price = document.getElementById('country-price').value;

        if (!name || !description || !price) {
            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            return;
        }

        const countryData = {
            id: currentEditingId || 'country-' + Date.now(),
            name: name,
            description: description,
            price: price,
            image: "images/travel-placeholder.jpg"
        };

        const countries = window.dataManager.getCountries();
        
        if (currentEditingId) {
            const index = countries.findIndex(c => c.id === currentEditingId);
            if (index !== -1) countries[index] = countryData;
        } else {
            countries.push(countryData);
        }

        const success = window.dataManager.updateCountries(countries);
        
        if (success) {
            alert(`‚úÖ –°—Ç—Ä–∞–Ω–∞ "${name}" ${currentEditingId ? '–æ–±–Ω–æ–≤–ª–µ–Ω–∞' : '–¥–æ–±–∞–≤–ª–µ–Ω–∞'}!`);
            closeModal();
            loadCountries();
            syncAndOpenMainPage();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω
    function loadCountries() {
        const container = document.getElementById('countries-list');
        const countries = window.dataManager.getCountries();

        if (countries.length === 0) {
            container.innerHTML = '<p>–°—Ç—Ä–∞–Ω –ø–æ–∫–∞ –Ω–µ—Ç</p>';
            return;
        }

        container.innerHTML = countries.map(country => `
            <div class="country-card">
                <h3>${country.name}</h3>
                <p>${country.description}</p>
                <p><strong>${country.price}</strong></p>
                <button class="btn" onclick="openModal('${country.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-danger" onclick="deleteCountry('${country.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `).join('');
    }

    function deleteCountry(countryId) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω—É?')) return;
        
        const countries = window.dataManager.getCountries().filter(c => c.id !== countryId);
        const success = window.dataManager.updateCountries(countries);
        
        if (success) {
            loadCountries();
            alert('‚úÖ –°—Ç—Ä–∞–Ω–∞ —É–¥–∞–ª–µ–Ω–∞!');
            syncAndOpenMainPage();
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    function loadContent() {
        const content = window.dataManager.getContent();
        document.getElementById('hero-title').value = content.heroTitle || '';
        document.getElementById('hero-text').value = content.heroText || '';
        document.getElementById('contact-phone').value = content.contactPhone || '';
        document.getElementById('contact-email').value = content.contactEmail || '';
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    function saveContent(event) {
        event.preventDefault();
        
        const content = {
            heroTitle: document.getElementById('hero-title').value,
            heroText: document.getElementById('hero-text').value,
            contactPhone: document.getElementById('contact-phone').value,
            contactEmail: document.getElementById('contact-email').value
        };

        const success = window.dataManager.updateContent(content);
        
        if (success) {
            alert('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            syncAndOpenMainPage();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞!');
        }
    }

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function syncAndOpenMainPage() {
        console.log('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...');
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
        const allData = {
            countries: window.dataManager.getCountries(),
            content: window.dataManager.getContent(),
            design: window.dataManager.getDesign(),
            settings: window.dataManager.getSettings()
        };
        
        localStorage.setItem('worldtravel_current_data', JSON.stringify(allData));
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:', allData);
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
        setTimeout(() => {
            const mainUrl = window.location.origin + '/web-travel/index.html?t=' + Date.now();
            window.open(mainUrl, '_blank');
            console.log('üìÑ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞:', mainUrl);
        }, 500);
    }

    function logout() {
        if (confirm('–í—ã–π—Ç–∏?')) {
            localStorage.removeItem('adminAuthenticated');
            window.location.href = 'admin-login.html';
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ –ê–¥–º–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        loadCountries();
        loadContent();
    });
    </script>
</body>
</html>
